<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMS | Dashboard</title>
    <link rel="stylesheet" href="../css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/dashboard-additions.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* specific dashboard overrides */
        body {
            display: block;
            /* Override flex center */
        }

        /* ... existing styles ... */
    </style>
</head>

<body>

    <!-- Reuse Background -->
    <div class="bg-image" style="background-image: url('../assets/inventory_system_background.png');"></div>

    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="title" style="font-size: 1.5rem; text-align: left; margin-bottom: 2rem;">
                <i class="fa-solid fa-cube"></i> IMS Cloud <span id="modeBadge" class="mode-badge">DEMO</span>
            </div>

            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-tab="dashboard">
                    <i class="fa-solid fa-chart-line"></i> Dashboard
                </a>

                <a href="#" class="nav-item" data-tab="purchase">
                    <i class="fa-solid fa-cart-shopping"></i> Purchase
                </a>
                <a href="#" class="nav-item" data-tab="sales">
                    <i class="fa-solid fa-cash-register"></i> Sales
                </a>
                <a href="#" class="nav-item" data-tab="expenses">
                    <i class="fa-solid fa-money-bill-wave"></i> Expenses
                </a>
                <a href="#" class="nav-item" data-tab="inventory">
                    <i class="fa-solid fa-boxes-stacked"></i> Inventory
                </a>
                <a href="#" class="nav-item" data-tab="reports">
                    <i class="fa-solid fa-file-invoice"></i> Reports
                </a>
                <!-- Admin Only -->
                <a href="#" class="nav-item hidden" id="adminTab" data-tab="admin">
                    <i class="fa-solid fa-users-gear"></i> Admin Panel
                </a>

                <div style="margin-top: auto;">
                    <a href="#" class="nav-item" id="logoutBtn">
                        <i class="fa-solid fa-right-from-bracket"></i> Logout
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <button class="btn-icon mobile-menu-toggle" id="sidebarToggle"
                        style="display: none; background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">
                        <i class="fa-solid fa-bars"></i>
                    </button>
                    <h2 id="pageTitle" style="font-size: 1.75rem;">Dashboard</h2>
                </div>
                <div class="user-profile" style="display: flex; align-items: center; gap: 1rem; cursor: pointer;"
                    onclick="openUserProfile()">
                    <span id="userNameDisplay">User Name</span>
                    <div
                        style="width: 40px; height: 40px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                        <i class="fa-solid fa-user"></i>
                    </div>
                </div>
            </header>

            <!-- Dashboard View -->
            <section id="dashboard" class="view-section">
                <!-- BANNER -->
                <div id="dashboardBannerContainer" style="margin-bottom: 1.5rem; text-align: center;"></div>

                <!-- Main Stats Grid -->
                <!-- Use override class for strict 4 columns single line -->
                <div class="stat-grid-override">

                    <!-- Total Inventory Value -->
                    <div class="stat-card blue">
                        <div class="stat-icon-wrapper">
                            <i class="fa-solid fa-sack-dollar"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">Total Inventory Value</div>
                            <div class="stat-value" id="dTotalValue">Rs. 0</div>
                        </div>
                        <div class="stat-progress-container">
                            <div class="stat-progress-bar bg-blue" id="dTotalValueBar" style="width: 0%;"></div>
                        </div>
                    </div>

                    <!-- Total Products -->
                    <div class="stat-card orange">
                        <div class="stat-icon-wrapper">
                            <i class="fa-solid fa-boxes-stacked"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">Total Products</div>
                            <div class="stat-value" id="dTotalProducts">0</div>
                        </div>
                        <div class="stat-progress-container">
                            <div class="stat-progress-bar bg-orange" id="dTotalProductsBar" style="width: 0%;"></div>
                        </div>
                    </div>

                    <!-- Sales Today -->
                    <div class="stat-card green">
                        <div class="stat-icon-wrapper">
                            <i class="fa-solid fa-cart-shopping"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">Sales (Today)</div>
                            <div class="stat-value" id="dSalesToday">Rs. 0</div>
                        </div>
                        <div class="stat-progress-container">
                            <div class="stat-progress-bar bg-green" id="dSalesTodayBar" style="width: 0%;"></div>
                        </div>
                    </div>

                    <!-- SOP (Sales/Profit) -->
                    <div class="stat-card red">
                        <div class="stat-icon-wrapper">
                            <i class="fa-solid fa-chart-pie"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">SOP (Month)</div>
                            <div class="stat-value" id="dSoPMonth">Rs. 0</div>
                        </div>
                        <div class="stat-progress-container">
                            <div class="stat-progress-bar bg-red" id="dSoPMonthBar" style="width: 0%;"></div>
                        </div>
                    </div>

                </div>



                <!-- BROADCAST MARQUEE -->
                <div id="broadcastContainer" class="broadcast-container hidden" style="margin-bottom: 1.5rem;">
                    <div class="broadcast-icon"><i class="fa-solid fa-bullhorn"></i></div>
                    <div class="broadcast-wrapper">
                        <div class="broadcast-content" id="broadcastText">
                            <!-- JS Populated -->
                        </div>
                    </div>
                </div>

                <!-- Quick Actions Grid ("Small Boxes") -->
                <h3 style="margin-bottom: 1rem; color: #ddd; font-size: 1.1rem;">Quick Actions</h3>
                <!-- Used same override grid for single line layout -->
                <div class="quick-actions-override" style="margin-bottom: 2rem;">

                    <!-- New Purchase -->
                    <div class="stat-card action-btn blue"
                        onclick="document.querySelector('[data-tab=purchase]').click()">
                        <div class="stat-icon-wrapper">
                            <i class="fa-solid fa-cart-shopping"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">Action</div>
                            <div class="stat-value" style="font-size: 1rem;">New Purchase</div>
                        </div>
                    </div>

                    <!-- New Sale -->
                    <div class="stat-card action-btn green"
                        onclick="document.querySelector('[data-tab=sales]').click()">
                        <div class="stat-icon-wrapper">
                            <i class="fa-solid fa-cash-register"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">Action</div>
                            <div class="stat-value" style="font-size: 1rem;">New Sale</div>
                        </div>
                    </div>

                    <!-- Add Expense -->
                    <div class="stat-card action-btn orange"
                        onclick="document.querySelector('[data-tab=expenses]').click()">
                        <div class="stat-icon-wrapper">
                            <i class="fa-solid fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">Action</div>
                            <div class="stat-value" style="font-size: 1rem;">Add Expense</div>
                        </div>
                    </div>

                    <!-- View Inventory -->
                    <div class="stat-card action-btn purple"
                        onclick="document.querySelector('[data-tab=inventory]').click()">
                        <div class="stat-icon-wrapper">
                            <i class="fa-solid fa-boxes-stacked"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">View</div>
                            <div class="stat-value" style="font-size: 1rem;">Inventory</div>
                        </div>
                    </div>

                    <!-- View Reports (If kept, it might wrap to next line or we can use 5 columns if space permits, but strict 4 requested. Maybe leave reports out or let it wrap?) - User said "same as image", usually 4. I will put 4 main actions. Reports is 5th. Let's add it, grid will likely wrap. -->
                    <div class="stat-card action-btn red"
                        onclick="document.querySelector('[data-tab=reports]').click()">
                        <div class="stat-icon-wrapper">
                            <i class="fa-solid fa-file-invoice"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">View</div>
                            <div class="stat-value" style="font-size: 1rem;">Reports</div>
                        </div>
                    </div>

                </div>

                <!-- Secondary Stats & Tables Row -->
                <div style="margin-bottom: 2rem;">

                    <!-- Low Stock & Top Products Grid -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">

                        <!-- Low Stock Table -->
                        <div class="glass-card">
                            <h3 style="margin-bottom: 1rem; color: #f59e0b;"><i
                                    class="fa-solid fa-triangle-exclamation"></i> Low
                                Stock Alerts</h3>
                            <table class="data-table" style="font-size: 0.9rem;">
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th>Qty</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="lowStockTableBody">
                                    <tr>
                                        <td colspan="3" style="text-align: center; color: #aaa;">No alerts</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Top Selling -->
                        <div class="glass-card">
                            <h3 style="margin-bottom: 1rem; color: #22c55e;"><i class="fa-solid fa-arrow-trend-up"></i>
                                Top Selling Products</h3>
                            <div id="topSellingList">
                                <p style="color: #aaa;">No sales data available</p>
                            </div>
                        </div>
                    </div>

                    <!-- Right: Recent Activity (Hidden) -->
                    <div class="glass-card" style="display: none;">
                        <!-- Hidden as per request -->
                        <h3 style="margin-bottom: 1rem;"><i class="fa-solid fa-clock-rotate-left"></i> Recent Activity
                        </h3>
                        <ul id="activityLog" style="list-style: none; padding: 0; color: #ccc; font-size: 0.9rem;">
                            <li
                                style="margin-bottom: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 0.5rem;">
                                <div style="color: white; font-weight: 500;">System Login</div>
                                <div style="font-size: 0.8rem;">Admin accessed dashboard</div>
                            </li>
                            <!-- Populated via JS (Mock or Real) -->
                        </ul>
                    </div>
                </div>


                <!-- Dashboard Banner Position -->
                <div id="dashboardBannerContainer"
                    style="margin-top: 2rem; width: 100%; display: flex; justify-content: center;">
                    <!-- Injected via JS -->
                </div>
            </section>

            <!-- Inventory View -->
            <section id="inventory" class="view-section hidden">
                <div class="glass-card" style="max-width: 100%;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>Available Inventory</h3>
                        <div>
                            <input type="file" id="importExcelInput" accept=".xlsx, .xls, .csv" style="display: none;"
                                onchange="handleInventoryImport(event)">
                            <button class="btn" style="background: #10b981; width: auto; padding: 0.4rem 1rem;"
                                onclick="document.getElementById('importExcelInput').click()">
                                <i class="fa-solid fa-file-excel"></i> Import Inventory
                            </button>
                        </div>
                    </div>
                    <div style="overflow-x: auto; overflow-y: auto; max-height: 55vh; width: 100%;">
                        <table class="data-table">
                            <thead style="color: #fbbf24;" id="inventoryTableHeader">
                                <tr>
                                    <th style="padding: 1rem 1.5rem; white-space: nowrap;">Date</th>
                                    <th style="padding: 1rem 1.5rem; white-space: nowrap;">Category</th>
                                    <th style="padding: 1rem 1.5rem; white-space: nowrap;">Vendor</th>
                                    <th style="padding: 1rem 1.5rem; white-space: nowrap;">Item Name</th>
                                    <th style="padding: 1rem 1.5rem; white-space: nowrap;">Brand</th>
                                    <th style="padding: 1rem 1.5rem; white-space: nowrap;">Model</th>
                                    <th style="padding: 1rem 1.5rem; white-space: nowrap;">Quantity</th>
                                    <th style="padding: 1rem 1.5rem; white-space: nowrap;">Unit Price</th>
                                    <th style="padding: 1rem 1.5rem; white-space: nowrap;">Total</th>
                                    <th style="padding: 1rem 1.5rem; white-space: nowrap;">Paid</th>
                                    <th style="padding: 1rem 1.5rem; white-space: nowrap;">Mode</th>
                                    <th style="padding: 1rem 1.5rem; white-space: nowrap;">Balance</th>
                                    <th style="padding: 1rem 1.5rem; white-space: nowrap;">Action</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTableBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Edit Inventory Segment -->
                <div class="glass-card" style="max-width: 100%; margin-top: 2rem;" id="editInventorySegment">
                    <h3 style="margin-bottom: 1rem; color: #3b82f6;"><i class="fa-solid fa-pen-to-square"></i> Edit
                        Inventory Item</h3>

                    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; align-items: end;">
                        <div class="form-group" style="margin-bottom: 0; flex: 1; max-width: 300px;">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Search by Inventory ID</label>
                            <input type="text" class="form-input" id="searchEditId" placeholder="Enter ID..."
                                style="padding: 0.5rem; font-size: 0.9rem;">
                        </div>
                        <button type="button" class="btn" id="btnSearchEdit" onclick="searchInventoryForEdit()"
                            style="background: #3b82f6; width: auto; padding: 0.5rem 1rem; height: 38px;">
                            <i class="fa-solid fa-magnifying-glass"></i> Search
                        </button>
                    </div>

                    <!-- Dynamic Form for Editing -->
                    <form id="editInventoryForm" class="hidden"
                        onsubmit="event.preventDefault(); submitEditInventory();"
                        style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; align-items: end;">

                        <div id="editDynamicFieldsContainer" style="display: contents;">
                            <!-- JS Injected Fields Go Here -->
                        </div>

                        <div class="form-group" style="grid-column: 1 / -1; margin-top: 1rem;">
                            <button type="submit" class="btn" id="btnUpdateInventory"
                                style="background: #22c55e; width: 100%; padding: 0.5rem; font-size: 0.9rem;">
                                <i class="fa-solid fa-save"></i> Update Inventory
                            </button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- Purchase View -->
            <section id="purchase" class="view-section hidden">
                <div class="glass-card" style="max-width: 100%;">
                    <h3>Purchase Entry</h3>
                    <form id="purchaseForm"
                        style="margin-top: 0.5rem; display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; align-items: end;">

                        <!-- Row 1: Basic Info -->
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Date</label>
                            <input type="date" class="form-input" id="purDate" readonly
                                style="padding: 0.25rem; font-size: 0.85rem; background: rgba(255,255,255,0.05);">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Category</label>
                            <select class="form-input" id="purCategorySelect" required
                                style="padding: 0.25rem; font-size: 0.85rem; color: #333; background: white;">
                                <option value="">Select Category</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Vendor Name</label>
                            <input type="text" class="form-input" id="purVendor" placeholder="Vendor Name"
                                style="padding: 0.25rem; font-size: 0.85rem;">
                        </div>

                        <!-- Row 2: Standard Items (Hidden if Laptop) -->
                        <div class="form-group group-standard">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Item Name</label>
                            <input type="text" class="form-input" id="purItem" placeholder="Item Name" required
                                style="padding: 0.25rem; font-size: 0.85rem;">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Brand</label>
                            <input type="text" class="form-input" id="purBrand" placeholder="Brand"
                                style="padding: 0.25rem; font-size: 0.85rem;">
                        </div>

                        <!-- Specialized Laptop Fields (Hidden by default) -->
                        <div class="form-group group-laptop hidden">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Generation / Class</label>
                            <select class="form-input" id="purGen"
                                style="padding: 0.25rem; font-size: 0.85rem; color: #333; background: white;">
                                <option value="">Select Generation</option>
                                <option value="Chromebook">Chromebook</option>
                                <option value="1st Gen">1st Gen</option>
                                <option value="2nd Gen">2nd Gen</option>
                                <option value="3rd Gen">3rd Gen</option>
                                <option value="4th Gen">4th Gen</option>
                                <option value="5th Gen">5th Gen</option>
                                <option value="6th Gen">6th Gen</option>
                                <option value="7th Gen">7th Gen</option>
                                <option value="8th Gen">8th Gen</option>
                                <option value="9th Gen">9th Gen</option>
                                <option value="10th Gen">10th Gen</option>
                                <option value="11th Gen">11th Gen</option>
                                <option value="12th Gen">12th Gen</option>
                                <option value="AMD">AMD</option>
                                <option value="MacBook">MacBook</option>
                            </select>
                        </div>
                        <div class="form-group group-laptop hidden">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Model</label>
                            <input type="text" class="form-input" id="purModel" placeholder="e.g. Latitude 7480"
                                style="padding: 0.25rem; font-size: 0.85rem;">
                        </div>
                        <div class="form-group group-laptop hidden">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">RAM</label>
                            <select class="form-input" id="purRam"
                                style="padding: 0.25rem; font-size: 0.85rem; color: #333; background: white;">
                                <option value="">Select RAM</option>
                                <option value="4GB">4GB</option>
                                <option value="8GB">8GB</option>
                                <option value="16GB">16GB</option>
                                <option value="32GB">32GB</option>
                            </select>
                        </div>
                        <div class="form-group group-laptop hidden">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">HDD/SSD</label>
                            <select class="form-input" id="purHdd"
                                style="padding: 0.25rem; font-size: 0.85rem; color: #333; background: white;">
                                <option value="">Select Storage</option>
                                <option value="16GB">16GB</option>
                                <option value="32GB">32GB</option>
                                <option value="64GB">64GB</option>
                                <option value="128GB SSD">128GB SSD</option>
                                <option value="256GB SSD">256GB SSD</option>
                                <option value="512GB SSD">512GB SSD</option>
                                <option value="1TB HDD">1TB HDD</option>
                                <option value="1TB SSD">1TB SSD</option>
                            </select>
                        </div>
                        <div class="form-group group-laptop hidden">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Display Size</label>
                            <select class="form-input" id="purDisplay"
                                style="padding: 0.25rem; font-size: 0.85rem; color: #333; background: white;">
                                <option value="">Select Size</option>
                                <option value="11.6 inch">11.6 inch</option>
                                <option value="12.5 inch">12.5 inch</option>
                                <option value="13.3 inch">13.3 inch</option>
                                <option value="14 inch">14 inch</option>
                                <option value="15.6 inch">15.6 inch</option>
                                <option value="17 inch">17 inch</option>
                            </select>
                        </div>
                        <div class="form-group group-laptop hidden">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Touch Screen</label>
                            <select class="form-input" id="purTouch"
                                style="padding: 0.25rem; font-size: 0.85rem; color: #333; background: white;">
                                <option value="Non-Touch">Non-Touch</option>
                                <option value="Touch">Touch</option>
                                <option value="360 Rotation">360 Rotation</option>
                            </select>
                        </div>
                        <!-- Chromebook Only -->
                        <div class="form-group group-chromebook hidden">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Auto Update Expiry</label>
                            <input type="text" class="form-input" id="purUpdate" placeholder="Jun 2028"
                                style="padding: 0.25rem; font-size: 0.85rem;">
                        </div>


                        <!-- Keyboard & Mouse Only -->
                        <div class="form-group group-kbmouse hidden">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Item Type</label>
                            <select class="form-input" id="purKbType"
                                style="padding: 0.25rem; font-size: 0.85rem; color: #333; background: white;">
                                <option value="Keyboard">Keyboard</option>
                                <option value="Mouse">Mouse</option>
                                <option value="Keyboard & Mouse">Keyboard & Mouse</option>
                            </select>
                        </div>

                        <!-- Charger Only -->
                        <div class="form-group group-charger hidden">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Volt / Watt</label>
                            <input type="text" class="form-input" id="purVolt" placeholder="e.g. 65W, 19V"
                                style="padding: 0.25rem; font-size: 0.85rem;">
                        </div>

                        <!-- Dynamic Purchase Fields (Injected by JS if user has Custom Headers) -->
                        <div id="dynamicPurchaseFields" style="display: contents;">
                            <!-- Injected here -->
                        </div>

                        <!-- Row 3: Financials (Shared) -->
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Unit Price</label>
                            <input type="number" class="form-input" id="purPrice" placeholder="0.00"
                                style="padding: 0.25rem; font-size: 0.85rem;">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Quantity</label>
                            <input type="number" class="form-input" id="purQty" placeholder="0"
                                style="padding: 0.25rem; font-size: 0.85rem;">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Total Price</label>
                            <input type="number" class="form-input" id="purTotal" readonly
                                style="background: rgba(255,255,255,0.05); color: #fbbf24; font-weight: bold; padding: 0.25rem; font-size: 0.85rem;">
                        </div>

                        <!-- Row 4: Payment -->
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Amount Paid</label>
                            <input type="number" class="form-input" id="purPaid" placeholder="0.00"
                                style="padding: 0.25rem; font-size: 0.85rem;">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Payment Mode</label>
                            <select class="form-input" id="purMode"
                                style="padding: 0.25rem; font-size: 0.85rem; color: #333; background: white;">
                                <option value="Cash" style="color: black;">Cash</option>
                                <option value="Cheque" style="color: black;">Cheque</option>
                                <option value="Online" style="color: black;">Online</option>
                                <option value="Credit" style="color: black;">Credit (Unpaid)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Balance Amount</label>
                            <input type="number" class="form-input" id="purBalance" readonly
                                style="background: rgba(255,255,255,0.05); color: #ef4444; font-weight: bold; padding: 0.25rem; font-size: 0.85rem;">
                        </div>

                        <div class="form-group" style="grid-column: 1 / -1; margin-top: 0.5rem;">
                            <button type="submit" class="btn"
                                style="width: 100%; padding: 0.4rem; font-size: 0.9rem;">Record
                                Purchase</button>
                        </div>
                    </form>

                    <!-- Recent Purchases Table -->
                    <div style="margin-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 1rem;">
                        <h4 style="margin-bottom: 0.5rem; color: #ccc;">Recent Purchases (Last 7 Days)</h4>
                        <table class="data-table compact" style="font-size: 0.85rem;">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Product / Item Name</th>
                                    <th>Vendor Name</th>
                                    <th>Quantity</th>
                                    <th>Paid Amount</th>
                                    <th>Balance</th>
                                </tr>
                            </thead>
                            <tbody id="recentPurchasesTableBody">
                                <tr>
                                    <td colspan="6" style="text-align: center; color: #666;">No entries yet</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Sales View -->
            <section id="sales" class="view-section hidden">
                <div class="glass-card" style="max-width: 100%;">
                    <h3>New Sale</h3>
                    <form id="salesForm"
                        style="margin-top: 0.5rem; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.5rem; align-items: end;">

                        <!-- Row 1 -->
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Date</label>
                            <input type="date" class="form-input" id="saleDate" readonly
                                style="background: rgba(255,255,255,0.05); padding: 0.25rem; font-size: 0.85rem;">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Customer Name</label>
                            <input type="text" class="form-input" id="saleCustomer" placeholder="Walk-in / Name"
                                style="padding: 0.25rem; font-size: 0.85rem;">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Item</label>
                            <select class="form-input" id="saleItem"
                                style="padding: 0.25rem; font-size: 0.85rem; background: white; color: #333;"></select>
                        </div>

                        <!-- Row 2 -->
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Quantity</label>
                            <input type="number" class="form-input" id="saleQty" placeholder="0"
                                style="padding: 0.25rem; font-size: 0.85rem;">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Unit Price</label>
                            <input type="number" class="form-input" id="salePrice" placeholder="0.00"
                                style="padding: 0.25rem; font-size: 0.85rem;">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Total Amount</label>
                            <input type="number" class="form-input" id="saleTotal" readonly
                                style="background: rgba(255,255,255,0.05); color: #fbbf24; font-weight: bold; padding: 0.25rem; font-size: 0.85rem;">
                        </div>

                        <!-- Row 3 -->
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Amount Paid</label>
                            <input type="number" class="form-input" id="salePaid" placeholder="0.00"
                                style="padding: 0.25rem; font-size: 0.85rem;">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Payment Mode</label>
                            <select class="form-input" id="saleMode"
                                style="padding: 0.25rem; font-size: 0.85rem; background: white; color: #333;">
                                <option value="Cash">Cash</option>
                                <option value="Online">Online</option>
                                <option value="Cheque">Cheque</option>
                                <option value="Credit">Credit (Unpaid)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Balance</label>
                            <input type="number" class="form-input" id="saleBalance" readonly
                                style="background: rgba(255,255,255,0.05); color: #ef4444; font-weight: bold; padding: 0.25rem; font-size: 0.85rem;">
                        </div>

                        <!-- Row 4: Button -->
                        <div class="form-group" style="grid-column: 1 / -1; margin-top: 0.5rem;">
                            <button type="submit" class="btn"
                                style="width: 100%; padding: 0.4rem; font-size: 0.9rem;">Record Sale</button>
                        </div>
                    </form>

                    <!-- Recent Sales Table -->
                    <div style="margin-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 1rem;">
                        <h4 style="margin-bottom: 0.5rem; color: #ccc;">Recent Sales (This Session)</h4>
                        <table class="data-table compact" style="font-size: 0.85rem;">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Customer Name</th>
                                    <th>Item Name</th>
                                    <th>Unit Price</th>
                                    <th>Qty</th>
                                    <th>Total Amount</th>
                                    <th>Amount Paid</th>
                                    <th>Payment Mode</th>
                                    <th>Balance</th>
                                </tr>
                            </thead>
                            <tbody id="recentSalesTableBody">
                                <tr>
                                    <td colspan="9" style="text-align: center; color: #666;">No entries yet</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Expenses View -->
            <section id="expenses" class="view-section hidden">
                <div class="glass-card" style="max-width: 100%;">
                    <h3>Record Expense</h3>
                    <form id="expenseForm"
                        style="margin-top: 0.5rem; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.5rem; align-items: end;">

                        <!-- Row 1 -->
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Date</label>
                            <input type="date" class="form-input" id="expDate"
                                style="padding: 0.25rem; font-size: 0.85rem;">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Expense Title</label>
                            <select class="form-input" id="expTitle"
                                style="padding: 0.25rem; font-size: 0.85rem; color: #333; background: white;">
                                <option value="">Select Expense</option>
                                <option value="Daily Expense">Daily Expense</option>
                                <option value="Lunch">Lunch</option>
                                <option value="Daily Wages">Daily Wages</option>
                                <option value="Salary">Salary</option>
                                <option value="Electric">Electric</option>
                                <option value="Maintenance">Maintenance</option>
                                <option value="Phone Bill">Phone Bill</option>
                                <option value="Shop Rent">Shop Rent</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Description (Optional)</label>
                            <input type="text" class="form-input" id="expDesc" placeholder="Details..."
                                style="padding: 0.25rem; font-size: 0.85rem;">
                        </div>

                        <!-- Row 2 -->
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Amount</label>
                            <input type="number" class="form-input" id="expAmount" placeholder="0.00"
                                style="padding: 0.25rem; font-size: 0.85rem;">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 0.8rem; margin-bottom: 0.2rem;">Payment Mode</label>
                            <select class="form-input" id="expMode"
                                style="padding: 0.25rem; font-size: 0.85rem; color: #333; background: white;">
                                <option value="Cash">Cash</option>
                                <option value="Cheque">Cheque</option>
                                <option value="Online">Online</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn"
                                style="width: 100%; padding: 0.4rem; font-size: 0.9rem;">Save
                                Expense</button>
                        </div>
                    </form>

                    <!-- Recent Expenses Table -->
                    <div style="margin-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 1rem;">
                        <h4 style="margin-bottom: 0.5rem; color: #ccc;">Recent Expenses</h4>
                        <table class="data-table compact" style="font-size: 0.85rem;">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Expense Title</th>
                                    <th>Amount Paid</th>
                                    <th>Payment Mode</th>
                                </tr>
                            </thead>
                            <tbody id="recentExpensesTableBody">
                                <tr>
                                    <td colspan="9" style="text-align: center; color: #666;">No entries yet</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Admin View -->
            <section id="admin" class="view-section hidden">
                <!-- Admin Header Stats -->
                <div class="admin-stat-grid">
                    <div class="stat-card admin-stat-card card-blue">
                        <div class="stat-icon"><i class="fa-solid fa-users"></i></div>
                        <div>
                            <h3>Total Users</h3>
                            <div class="stat-value" id="countTotalUsers">0</div>
                        </div>
                    </div>
                    <div class="stat-card admin-stat-card card-green">
                        <div class="stat-icon"><i class="fa-solid fa-user-check"></i></div>
                        <div>
                            <h3>Active Users</h3>
                            <div class="stat-value" id="countActiveUsers">0</div>
                        </div>
                    </div>
                    <div class="stat-card admin-stat-card card-orange">
                        <div class="stat-icon"><i class="fa-solid fa-user-clock"></i></div>
                        <div>
                            <h3>Pending</h3>
                            <div class="stat-value" id="countPendingUsers">0</div>
                        </div>
                    </div>
                </div>

                <div class="glass-card" style="max-width: 100%; overflow-x: auto; overflow-y: auto; max-height: 55vh;">
                    <h3 style="margin-bottom: 1rem;">User Management</h3>
                    <!-- Hidden File Input for Profile Upload -->
                    <input type="file" id="profileUpload" accept="image/*" style="display:none">

                    <h4 style="margin: 1rem 0 0.5rem 0; color: #60a5fa;">Regular Users</h4>
                    <table class="data-table" style="margin-bottom: 2rem;">
                        <thead>
                            <tr>
                                <th>Picture</th>
                                <th>User Name</th>
                                <th>Company</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="regularUserTableBody">
                            <!-- Populated by admin.js -->
                        </tbody>
                    </table>

                    <h4 style="margin: 1rem 0 0.5rem 0; color: #f59e0b;">System Users</h4>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Picture</th>
                                <th>Role</th>
                                <th>Name</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="systemUserTableBody">
                            <!-- Populated by admin.js -->
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="reports" class="view-section hidden">
                <div class="glass-card" style="max-width: 100%;">
                    <div
                        style="display: flex; flex-wrap: wrap; gap: 1rem; justify-content: space-between; align-items: flex-end; margin-bottom: 2rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 1.5rem;">
                        <!-- Filters -->
                        <div style="display:flex; gap: 1rem; flex-wrap: wrap; align-items: flex-end;">
                            <div class="form-group" style="margin-bottom:0; min-width: 150px;">
                                <label style="margin-bottom: 0.3rem;">Report Type</label>
                                <select id="reportType" class="form-input"
                                    style="color:#333; background:white; padding: 0.5rem;">
                                    <option value="sales">Sales Report</option>
                                    <option value="purchase">Purchase Report</option>
                                    <option value="expenses">Expense Report</option>
                                    <option value="vendor">Vendor Report</option>
                                    <option value="item">Item/Inventory Report</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-bottom:0;">
                                <label style="margin-bottom: 0.3rem;">Frequency</label>
                                <select id="reportFreq" class="form-input"
                                    style="color:#333; background:white; padding: 0.5rem;">
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly" selected>Monthly</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-bottom:0;">
                                <label style="margin-bottom: 0.3rem;">Date / Month</label>
                                <input type="date" id="reportDate" class="form-input" style="padding: 0.5rem;">
                            </div>
                            <button class="btn" onclick="if(window.generateReport) window.generateReport()"
                                style="width: auto; padding: 0.6rem 1.2rem; height: 42px;"><i
                                    class="fa-solid fa-filter"></i>
                                Generate</button>
                        </div>

                        <div style="display:flex; gap: 0.5rem;">
                            <button class="btn" style="width: auto; background: #ef4444; height: 42px;"
                                onclick="if(window.downloadPDF) window.downloadPDF()"><i
                                    class="fa-solid fa-file-pdf"></i>
                                PDF</button>
                            <button class="btn" style="width: auto; background: #22c55e; height: 42px;"
                                onclick="window.print()"><i class="fa-solid fa-print"></i> Print</button>
                        </div>
                    </div>

                    <!-- Report Title Dynamic -->
                    <h3 id="reportTitleDisplay" style="margin-bottom: 1rem; color: #60a5fa;">Monthly Sales Report</h3>

                    <!-- Summary Cards -->
                    <div class="stat-grid"
                        style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;"
                        id="reportSummary">
                        <!-- Injected via JS -->
                    </div>

                    <!-- Table -->
                    <div style="overflow-x: auto; overflow-y: auto; max-height: 55vh;">
                        <table class="data-table">
                            <thead id="reportThead">
                                <!-- Injected via JS -->
                            </thead>
                            <tbody id="reportTbody">
                                <tr>
                                    <td colspan="10" style="text-align:center; padding: 2rem; color: #aaa;">Select
                                        filters and click Generate</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- User Profile View -->
            <section id="profile" class="view-section hidden">
                <div class="glass-card" style="max-width: 100%;">
                    <div style="display: flex; align-items: center; gap: 1.5rem; margin-bottom: 2rem;">
                        <div id="pAvatar"
                            style="width: 80px; height: 80px; background: #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; border: 3px solid var(--primary);">
                            <i class="fa-solid fa-user"></i>
                        </div>
                        <div>
                            <h2 id="pName" style="margin: 0; font-size: 1.8rem;">User Name</h2>
                            <p id="pCompany" style="color: #aaa; margin: 0;">Company Name</p>
                            <span id="pRole" class="status-badge status-active"
                                style="margin-top: 0.5rem; display: inline-block;">User</span>
                            <div style="margin-top: 1rem;">
                                <button class="btn" style="width: auto; padding: 0.4rem 1rem; font-size: 0.9rem;"
                                    onclick="openChangePassword()"><i class="fa-solid fa-key"></i> Change
                                    Password</button>
                            </div>
                        </div>
                    </div>

                    <h3
                        style="margin-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 0.5rem;">
                        <i class="fa-solid fa-chart-bar" style="color: #60a5fa;"></i> Bar Chart Heading
                    </h3>
                    <div style="height: 350px; width: 100%;">
                        <canvas id="salesChart"></canvas>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Modals -->

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="modal-overlay hidden">
        <div class="glass-card" style="max-width: 400px; width: 90%;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 1.5rem;">
                <h3>Change Password</h3>
                <button class="btn" style="width: auto; padding: 0.2rem 0.6rem; background: var(--error);"
                    onclick="closeModal('changePasswordModal')"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <form id="changePasswordForm" onsubmit="event.preventDefault(); submitChangePassword();">
                <div class="form-group">
                    <label>Current Password</label>
                    <input type="password" id="cpOld" class="form-input" required>
                </div>
                <div class="form-group">
                    <label>New Password</label>
                    <input type="password" id="cpNew" class="form-input" required>
                </div>
                <div class="form-group">
                    <label>Confirm New Password</label>
                    <input type="password" id="cpConfirm" class="form-input" required>
                </div>
                <button type="submit" class="btn"><i class="fa-solid fa-save"></i> Update Password</button>
            </form>
        </div>
    </div>

    <!-- Add Item Modal -->
    <div id="addItemModal" class="modal-overlay hidden">
        <div class="glass-card" style="max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 1.5rem;">
                <h3>Add New Inventory Item</h3>
                <button class="btn" style="width: auto; padding: 0.2rem 0.6rem; background: var(--error);"
                    onclick="closeModal('addItemModal')"><i class="fa-solid fa-xmark"></i></button>
            </div>

            <form id="addItemForm" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <!-- Row 1: Date & Vendor -->
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" class="form-input" id="invDate" readonly>
                </div>
                <div class="form-group">
                    <label>Vendor Name</label>
                    <input type="text" class="form-input" id="invVendor" placeholder="Vendor Name">
                </div>

                <!-- Row 2: Category & Item Name -->
                <div class="form-group">
                    <label>Category</label>
                    <input type="text" class="form-input" id="invCategory" list="categoryList"
                        placeholder="Select or Type">
                    <datalist id="categoryList">
                        <option value="Electronics">
                        <option value="Furniture">
                        <option value="Stationery">
                    </datalist>
                </div>
                <div class="form-group">
                    <label>Item Name</label>
                    <input type="text" class="form-input" id="invItemName" placeholder="Item Name">
                </div>

                <!-- Row 3: Brand & Model -->
                <div class="form-group">
                    <label>Brand</label>
                    <input type="text" class="form-input" id="invBrand" placeholder="Brand">
                </div>
                <div class="form-group">
                    <label>Model</label>
                    <input type="text" class="form-input" id="invModel" placeholder="Model">
                </div>

                <!-- Row 4: Qty & Price -->
                <div class="form-group">
                    <label>Quantity</label>
                    <input type="number" class="form-input" id="invQty" placeholder="0" oninput="calculateInvTotal()">
                </div>
                <div class="form-group">
                    <label>Price Per Unit</label>
                    <input type="number" class="form-input" id="invPrice" placeholder="0.00"
                        oninput="calculateInvTotal()">
                </div>

                <!-- Row 5: Total & Payment Mode -->
                <div class="form-group">
                    <label>Total Amount</label>
                    <input type="number" class="form-input" id="invTotal" readonly
                        style="background: rgba(255,255,255,0.05); color: #fbbf24; font-weight: bold;">
                </div>
                <div class="form-group">
                    <label>Payment Mode</label>
                    <select class="form-input" id="invPayMode">
                        <option value="Cash">Cash</option>
                        <option value="Cheque">Cheque</option>
                        <option value="Online">Online</option>
                        <option value="Credit">Credit (Unpaid)</option>
                    </select>
                </div>

                <!-- Row 6: Paid & Balance -->
                <div class="form-group">
                    <label>Amount Paid</label>
                    <input type="number" class="form-input" id="invPaid" placeholder="0.00"
                        oninput="calculateInvBalance()">
                </div>
                <div class="form-group">
                    <label>Balance Amount</label>
                    <input type="number" class="form-input" id="invBalance" readonly
                        style="background: rgba(255,255,255,0.05); color: #ef4444; font-weight: bold;">
                </div>

                <div class="form-group" style="grid-column: span 2; margin-top: 1rem;">
                    <button type="submit" class="btn">Save Item</button>
                </div>
            </form>
        </div>
    </div>

    <script src="../js/api.js"></script>
    <script src="../js/app.js"></script>
    <script src="../js/admin.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="../js/reports.js"></script>
</body>

</html>